{"ast":null,"code":"var _jsxFileName = \"C:\\\\Proyectos\\\\ITAM_System\\\\itam_frontend\\\\src\\\\components\\\\UserForm.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\n// IMPORTANTE: Se asume que '../api' contiene las funciones de la API\n// Asegúrate de que tu archivo api.js exporte getRegions y getDepartamentos\nimport { getRegions, getDepartamentos } from '../api';\nimport { toast } from 'react-toastify';\nimport { useAuth } from '../context/AuthContext'; // Para obtener el usuario logueado\n\n// Opciones para los campos de selección estáticos\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PUESTO_CHOICES = ['Gerente', 'Coordinador', 'Analista', 'Técnico', 'Desarrollador', 'Soporte', 'Otro'];\nconst STATUS_CHOICES = ['Activo', 'Inactivo', 'Vacaciones', 'Licencia'];\n\n// UserForm ahora recibe 'roles', 'onClose' y 'onSubmit' (que maneja la lógica de la API)\nfunction UserForm({\n  user,\n  onClose,\n  onSubmit,\n  roles\n}) {\n  _s();\n  const isEditing = !!user;\n  const {\n    user: loggedInUser\n  } = useAuth(); // Para verificar si es superusuario\n\n  // El estado de los campos de clave foránea (FK) debe inicializarse como null\n  const initialFormData = {\n    username: '',\n    email: '',\n    password: '',\n    first_name: '',\n    last_name: '',\n    puesto: '',\n    departamento: null,\n    // ID del departamento (debe ser null para FK opcionales en el backend)\n    region: null,\n    // ID de la región (debe ser null para FK opcionales en el backend)\n    status: 'Activo',\n    assigned_role_id: null,\n    // ID del grupo/rol\n    is_staff: false,\n    is_superuser: false\n  };\n  const [formData, setFormData] = useState(initialFormData);\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  // ESTADO PARA DATOS MAESTROS (NUEVO)\n  const [regions, setRegions] = useState([]);\n  const [departamentos, setDepartamentos] = useState([]);\n  useEffect(() => {\n    // Función para cargar los datos maestros\n    const fetchMasterData = async () => {\n      try {\n        // Usamos Promise.all para cargar regiones y departamentos en paralelo\n        const [regionsResponse, departamentosResponse] = await Promise.all([getRegions(), getDepartamentos()]);\n        // La data debe ser un array de objetos con { id, name }\n        setRegions(regionsResponse.data);\n        setDepartamentos(departamentosResponse.data);\n      } catch (err) {\n        console.error(\"Error al cargar datos maestros:\", err);\n        toast.error(\"Error al cargar las listas de Regiones y Departamentos.\");\n      }\n    };\n    fetchMasterData();\n    if (isEditing) {\n      // Lógica existente para precargar datos de usuario\n      // Asegúrate de que los campos 'departamento' y 'region' sean el ID o null\n      setFormData({\n        username: user.username || '',\n        email: user.email || '',\n        password: '',\n        // Nunca precargar la contraseña\n        first_name: user.first_name || '',\n        last_name: user.last_name || '',\n        puesto: user.puesto || '',\n        // IMPORTANTE: Asignar el ID. Si el valor es falsy (null, 0, undefined), se usa null.\n        departamento: user.departamento || null,\n        // user.departamento es el ID\n        region: user.region || null,\n        // user.region es el ID\n        status: user.status || 'Activo',\n        // El rol se maneja como un array de IDs en el backend, tomamos el primero o null\n        assigned_role_id: (user.groups && user.groups.length > 0 ? user.groups[0] : null) || null,\n        is_staff: user.is_staff || false,\n        is_superuser: user.is_superuser || false\n      });\n    }\n  }, [user, isEditing]);\n\n  // MANEJO DE CAMBIOS (ACTUALIZADO para manejar selects y nulls)\n  const handleChange = e => {\n    const {\n      name,\n      value,\n      type,\n      checked\n    } = e.target;\n    let newValue = value;\n\n    // Convertir el valor de los SELECTs a entero (ID) o null si se selecciona la opción vacía\n    if (name === 'departamento' || name === 'region' || name === 'assigned_role_id') {\n      // Si el valor del select es la cadena vacía (''), lo convertimos a null\n      // ya que representa 'Sin asignar' y el backend espera null para FK opcionales.\n      // De lo contrario, lo convertimos a entero.\n      newValue = value === '' ? null : parseInt(value, 10);\n    } else if (type === 'checkbox') {\n      newValue = checked;\n    }\n    setFormData(prev => ({\n      ...prev,\n      [name]: newValue\n    }));\n  };\n  const handleSubmit = e => {\n    e.preventDefault();\n    setError('');\n    if (!isEditing && formData.password.length < 8) {\n      setError('La contraseña debe tener al menos 8 caracteres.');\n      toast.error('La contraseña debe tener al menos 8 caracteres.');\n      return;\n    }\n\n    // Crear una copia de los datos, excluyendo la contraseña si estamos editando y no se ha cambiado\n    const dataToSend = {\n      ...formData\n    };\n    if (isEditing && !formData.password) {\n      delete dataToSend.password;\n    }\n\n    // El backend espera 'groups' como una lista de IDs, o un campo `assigned_role_id`\n    // que nuestro serializador convierte. Si el valor es null, enviamos un array vacío o null.\n    if (dataToSend.assigned_role_id !== null) {\n      dataToSend.assigned_role_id = [dataToSend.assigned_role_id];\n    } else {\n      // Si no hay rol seleccionado, enviar un array vacío para no desasignar todos los roles\n      // o ajusta según la lógica de tu Serializador (si acepta assigned_role_id: null, puedes omitir esta línea)\n      dataToSend.assigned_role_id = [];\n    }\n    setLoading(true);\n    // Llama a la función onSubmit (crear o actualizar) pasada por prop\n    onSubmit(dataToSend).then(() => {\n      setLoading(false);\n      onClose();\n    }).catch(err => {\n      var _err$response, _err$response$data, _err$response$data$us, _err$response2, _err$response2$data, _err$response2$data$e, _err$response3, _err$response3$data;\n      console.error(err.response || err);\n      const errorMessage = ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : (_err$response$data$us = _err$response$data.username) === null || _err$response$data$us === void 0 ? void 0 : _err$response$data$us[0]) || ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : (_err$response2$data$e = _err$response2$data.email) === null || _err$response2$data$e === void 0 ? void 0 : _err$response2$data$e[0]) || ((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.detail) || 'Error al guardar el usuario. Verifica los datos.';\n      setError(errorMessage);\n      toast.error(errorMessage);\n      setLoading(false);\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"space-y-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"username\",\n        className: \"block text-sm font-medium text-gray-700\",\n        children: \"Nombre de Usuario\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        id: \"username\",\n        name: \"username\",\n        value: formData.username,\n        onChange: handleChange,\n        required: true,\n        className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"email\",\n        className: \"block text-sm font-medium text-gray-700\",\n        children: \"Email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"email\",\n        id: \"email\",\n        name: \"email\",\n        value: formData.email,\n        onChange: handleChange,\n        required: true,\n        className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: isEditing ? '' : 'mb-4',\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        className: \"block text-sm font-medium text-gray-700\",\n        children: isEditing ? 'Contraseña (dejar vacío para no cambiar)' : 'Contraseña'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        id: \"password\",\n        name: \"password\",\n        value: formData.password,\n        onChange: handleChange,\n        required: !isEditing,\n        className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid grid-cols-1 sm:grid-cols-2 gap-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"first_name\",\n          className: \"block text-sm font-medium text-gray-700\",\n          children: \"Nombre\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          id: \"first_name\",\n          name: \"first_name\",\n          value: formData.first_name,\n          onChange: handleChange,\n          required: true,\n          className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"last_name\",\n          className: \"block text-sm font-medium text-gray-700\",\n          children: \"Apellido\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          id: \"last_name\",\n          name: \"last_name\",\n          value: formData.last_name,\n          onChange: handleChange,\n          required: true,\n          className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"puesto\",\n        className: \"block text-sm font-medium text-gray-700\",\n        children: \"Puesto\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"puesto\",\n        name: \"puesto\",\n        value: formData.puesto,\n        onChange: handleChange,\n        className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\",\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"-- Seleccionar Puesto --\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 21\n        }, this), PUESTO_CHOICES.map(choice => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: choice,\n          children: choice\n        }, choice, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 25\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"departamento\",\n        className: \"block text-sm font-medium text-gray-700\",\n        children: \"Departamento\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"departamento\",\n        name: \"departamento\"\n        // Usa || '' para manejar null/undefined y que el select funcione con la opción vacía\n        ,\n        value: formData.departamento || '',\n        onChange: handleChange,\n        className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\",\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"-- Sin Departamento --\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 21\n        }, this), departamentos.map(dpto => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: dpto.id,\n          children: dpto.name\n        }, dpto.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 25\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"region\",\n        className: \"block text-sm font-medium text-gray-700\",\n        children: \"Regi\\xF3n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"region\",\n        name: \"region\"\n        // Usa || '' para manejar null/undefined y que el select funcione con la opción vacía\n        ,\n        value: formData.region || '',\n        onChange: handleChange,\n        className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\",\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"-- Sin Regi\\xF3n --\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 21\n        }, this), regions.map(region => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: region.id,\n          children: region.name\n        }, region.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 25\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid grid-cols-1 sm:grid-cols-2 gap-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"assigned_role_id\",\n          className: \"block text-sm font-medium text-gray-700\",\n          children: \"Rol\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          id: \"assigned_role_id\",\n          name: \"assigned_role_id\",\n          value: formData.assigned_role_id || '',\n          onChange: handleChange,\n          className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\",\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"-- Sin Rol --\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 25\n          }, this), roles.map(role => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: role.id,\n            children: role.name\n          }, role.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 29\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"status\",\n          className: \"block text-sm font-medium text-gray-700\",\n          children: \"Estado\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          id: \"status\",\n          name: \"status\",\n          value: formData.status,\n          onChange: handleChange,\n          className: \"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\",\n          children: STATUS_CHOICES.map(choice => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: choice,\n            children: choice\n          }, choice, false, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 29\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 13\n    }, this), (loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.is_superuser) && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex space-x-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          name: \"is_staff\",\n          id: \"is_staff\",\n          checked: formData.is_staff,\n          onChange: handleChange,\n          className: \"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"is_staff\",\n          className: \"block text-sm font-medium text-gray-700\",\n          children: \"Es Staff\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          name: \"is_superuser\",\n          id: \"is_superuser\",\n          checked: formData.is_superuser,\n          onChange: handleChange,\n          className: \"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"is_superuser\",\n          className: \"block text-sm font-medium text-gray-700\",\n          children: \"Es Superuser\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 17\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-3 bg-red-100 border border-red-400 text-red-700 rounded text-sm\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-end space-x-3 pt-6 border-t border-gray-200\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: onClose,\n        className: \"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\",\n        children: \"Cancelar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        disabled: loading,\n        className: \"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\",\n        children: loading ? 'Guardando...' : isEditing ? 'Actualizar Usuario' : 'Crear Usuario'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 157,\n    columnNumber: 9\n  }, this);\n}\n_s(UserForm, \"YqPEL65WWPNtf1jgzRii+3r74fY=\", false, function () {\n  return [useAuth];\n});\n_c = UserForm;\nexport default UserForm;\nvar _c;\n$RefreshReg$(_c, \"UserForm\");","map":{"version":3,"names":["React","useState","useEffect","getRegions","getDepartamentos","toast","useAuth","jsxDEV","_jsxDEV","PUESTO_CHOICES","STATUS_CHOICES","UserForm","user","onClose","onSubmit","roles","_s","isEditing","loggedInUser","initialFormData","username","email","password","first_name","last_name","puesto","departamento","region","status","assigned_role_id","is_staff","is_superuser","formData","setFormData","error","setError","loading","setLoading","regions","setRegions","departamentos","setDepartamentos","fetchMasterData","regionsResponse","departamentosResponse","Promise","all","data","err","console","groups","length","handleChange","e","name","value","type","checked","target","newValue","parseInt","prev","handleSubmit","preventDefault","dataToSend","then","catch","_err$response","_err$response$data","_err$response$data$us","_err$response2","_err$response2$data","_err$response2$data$e","_err$response3","_err$response3$data","response","errorMessage","detail","className","children","htmlFor","fileName","_jsxFileName","lineNumber","columnNumber","id","onChange","required","map","choice","dpto","role","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Proyectos/ITAM_System/itam_frontend/src/components/UserForm.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\n// IMPORTANTE: Se asume que '../api' contiene las funciones de la API\r\n// Asegúrate de que tu archivo api.js exporte getRegions y getDepartamentos\r\nimport { getRegions, getDepartamentos } from '../api';\r\nimport { toast } from 'react-toastify';\r\nimport { useAuth } from '../context/AuthContext'; // Para obtener el usuario logueado\r\n\r\n// Opciones para los campos de selección estáticos\r\nconst PUESTO_CHOICES = [\r\n    'Gerente', 'Coordinador', 'Analista', 'Técnico', 'Desarrollador', 'Soporte', 'Otro'\r\n];\r\nconst STATUS_CHOICES = [\r\n    'Activo', 'Inactivo', 'Vacaciones', 'Licencia'\r\n];\r\n\r\n// UserForm ahora recibe 'roles', 'onClose' y 'onSubmit' (que maneja la lógica de la API)\r\nfunction UserForm({ user, onClose, onSubmit, roles }) { \r\n    const isEditing = !!user;\r\n    const { user: loggedInUser } = useAuth(); // Para verificar si es superusuario\r\n    \r\n    // El estado de los campos de clave foránea (FK) debe inicializarse como null\r\n    const initialFormData = {\r\n        username: '',\r\n        email: '',\r\n        password: '',\r\n        first_name: '',\r\n        last_name: '',\r\n        puesto: '',\r\n        departamento: null, // ID del departamento (debe ser null para FK opcionales en el backend)\r\n        region: null,       // ID de la región (debe ser null para FK opcionales en el backend)\r\n        status: 'Activo',\r\n        assigned_role_id: null, // ID del grupo/rol\r\n        is_staff: false,\r\n        is_superuser: false,\r\n    };\r\n\r\n    const [formData, setFormData] = useState(initialFormData);\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    \r\n    // ESTADO PARA DATOS MAESTROS (NUEVO)\r\n    const [regions, setRegions] = useState([]);\r\n    const [departamentos, setDepartamentos] = useState([]);\r\n\r\n\r\n    useEffect(() => {\r\n        // Función para cargar los datos maestros\r\n        const fetchMasterData = async () => {\r\n            try {\r\n                // Usamos Promise.all para cargar regiones y departamentos en paralelo\r\n                const [regionsResponse, departamentosResponse] = await Promise.all([\r\n                    getRegions(),\r\n                    getDepartamentos()\r\n                ]);\r\n                // La data debe ser un array de objetos con { id, name }\r\n                setRegions(regionsResponse.data); \r\n                setDepartamentos(departamentosResponse.data);\r\n            } catch (err) {\r\n                console.error(\"Error al cargar datos maestros:\", err);\r\n                toast.error(\"Error al cargar las listas de Regiones y Departamentos.\");\r\n            }\r\n        };\r\n\r\n        fetchMasterData();\r\n\r\n        if (isEditing) {\r\n            // Lógica existente para precargar datos de usuario\r\n            // Asegúrate de que los campos 'departamento' y 'region' sean el ID o null\r\n            setFormData({\r\n                username: user.username || '',\r\n                email: user.email || '',\r\n                password: '', // Nunca precargar la contraseña\r\n                first_name: user.first_name || '',\r\n                last_name: user.last_name || '',\r\n                puesto: user.puesto || '',\r\n                // IMPORTANTE: Asignar el ID. Si el valor es falsy (null, 0, undefined), se usa null.\r\n                departamento: user.departamento || null, // user.departamento es el ID\r\n                region: user.region || null,           // user.region es el ID\r\n                status: user.status || 'Activo',\r\n                // El rol se maneja como un array de IDs en el backend, tomamos el primero o null\r\n                assigned_role_id: (user.groups && user.groups.length > 0 ? user.groups[0] : null) || null,\r\n                is_staff: user.is_staff || false,\r\n                is_superuser: user.is_superuser || false,\r\n            });\r\n        }\r\n    }, [user, isEditing]);\r\n\r\n    // MANEJO DE CAMBIOS (ACTUALIZADO para manejar selects y nulls)\r\n    const handleChange = (e) => {\r\n        const { name, value, type, checked } = e.target;\r\n        let newValue = value;\r\n        \r\n        // Convertir el valor de los SELECTs a entero (ID) o null si se selecciona la opción vacía\r\n        if (name === 'departamento' || name === 'region' || name === 'assigned_role_id') {\r\n            // Si el valor del select es la cadena vacía (''), lo convertimos a null\r\n            // ya que representa 'Sin asignar' y el backend espera null para FK opcionales.\r\n            // De lo contrario, lo convertimos a entero.\r\n            newValue = value === '' ? null : parseInt(value, 10);\r\n        } else if (type === 'checkbox') {\r\n            newValue = checked;\r\n        }\r\n\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            [name]: newValue,\r\n        }));\r\n    };\r\n\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n\r\n        if (!isEditing && formData.password.length < 8) {\r\n            setError('La contraseña debe tener al menos 8 caracteres.');\r\n            toast.error('La contraseña debe tener al menos 8 caracteres.');\r\n            return;\r\n        }\r\n\r\n        // Crear una copia de los datos, excluyendo la contraseña si estamos editando y no se ha cambiado\r\n        const dataToSend = { ...formData };\r\n        if (isEditing && !formData.password) {\r\n            delete dataToSend.password;\r\n        }\r\n\r\n        // El backend espera 'groups' como una lista de IDs, o un campo `assigned_role_id`\r\n        // que nuestro serializador convierte. Si el valor es null, enviamos un array vacío o null.\r\n        if (dataToSend.assigned_role_id !== null) {\r\n            dataToSend.assigned_role_id = [dataToSend.assigned_role_id];\r\n        } else {\r\n            // Si no hay rol seleccionado, enviar un array vacío para no desasignar todos los roles\r\n            // o ajusta según la lógica de tu Serializador (si acepta assigned_role_id: null, puedes omitir esta línea)\r\n            dataToSend.assigned_role_id = [];\r\n        }\r\n\r\n\r\n        setLoading(true);\r\n        // Llama a la función onSubmit (crear o actualizar) pasada por prop\r\n        onSubmit(dataToSend)\r\n            .then(() => {\r\n                setLoading(false);\r\n                onClose();\r\n            })\r\n            .catch(err => {\r\n                console.error(err.response || err);\r\n                const errorMessage = err.response?.data?.username?.[0] || \r\n                                     err.response?.data?.email?.[0] || \r\n                                     err.response?.data?.detail || \r\n                                     'Error al guardar el usuario. Verifica los datos.';\r\n                setError(errorMessage);\r\n                toast.error(errorMessage);\r\n                setLoading(false);\r\n            });\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            {/* Campos básicos (no modificados) */}\r\n            <div>\r\n                <label htmlFor=\"username\" className=\"block text-sm font-medium text-gray-700\">Nombre de Usuario</label>\r\n                <input\r\n                    type=\"text\"\r\n                    id=\"username\"\r\n                    name=\"username\"\r\n                    value={formData.username}\r\n                    onChange={handleChange}\r\n                    required\r\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n            </div>\r\n\r\n            <div>\r\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                <input\r\n                    type=\"email\"\r\n                    id=\"email\"\r\n                    name=\"email\"\r\n                    value={formData.email}\r\n                    onChange={handleChange}\r\n                    required\r\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n            </div>\r\n\r\n            {/* Contraseña (solo requerida en creación o si se cambia en edición) */}\r\n            <div className={isEditing ? '' : 'mb-4'}>\r\n                <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">{isEditing ? 'Contraseña (dejar vacío para no cambiar)' : 'Contraseña'}</label>\r\n                <input\r\n                    type=\"password\"\r\n                    id=\"password\"\r\n                    name=\"password\"\r\n                    value={formData.password}\r\n                    onChange={handleChange}\r\n                    required={!isEditing}\r\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                <div>\r\n                    <label htmlFor=\"first_name\" className=\"block text-sm font-medium text-gray-700\">Nombre</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        id=\"first_name\"\r\n                        name=\"first_name\"\r\n                        value={formData.first_name}\r\n                        onChange={handleChange}\r\n                        required\r\n                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <label htmlFor=\"last_name\" className=\"block text-sm font-medium text-gray-700\">Apellido</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        id=\"last_name\"\r\n                        name=\"last_name\"\r\n                        value={formData.last_name}\r\n                        onChange={handleChange}\r\n                        required\r\n                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Campo Puesto (select estático) */}\r\n            <div>\r\n                <label htmlFor=\"puesto\" className=\"block text-sm font-medium text-gray-700\">Puesto</label>\r\n                <select\r\n                    id=\"puesto\"\r\n                    name=\"puesto\"\r\n                    value={formData.puesto}\r\n                    onChange={handleChange}\r\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                    <option value=\"\">-- Seleccionar Puesto --</option>\r\n                    {PUESTO_CHOICES.map(choice => (\r\n                        <option key={choice} value={choice}>{choice}</option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            {/* -------------------------------------------------- */}\r\n            {/* 🆕 DEPARTAMENTO (CAMBIADO A SELECT DINÁMICO) */}\r\n            {/* -------------------------------------------------- */}\r\n            <div>\r\n                <label htmlFor=\"departamento\" className=\"block text-sm font-medium text-gray-700\">Departamento</label>\r\n                <select\r\n                    id=\"departamento\"\r\n                    name=\"departamento\"\r\n                    // Usa || '' para manejar null/undefined y que el select funcione con la opción vacía\r\n                    value={formData.departamento || ''} \r\n                    onChange={handleChange}\r\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                    <option value=\"\">-- Sin Departamento --</option> \r\n                    {departamentos.map(dpto => (\r\n                        <option key={dpto.id} value={dpto.id}>\r\n                            {dpto.name}\r\n                        </option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            {/* -------------------------------------------------- */}\r\n            {/* 🆕 REGIÓN (CAMBIADO A SELECT DINÁMICO) */}\r\n            {/* -------------------------------------------------- */}\r\n            <div>\r\n                <label htmlFor=\"region\" className=\"block text-sm font-medium text-gray-700\">Región</label>\r\n                <select\r\n                    id=\"region\"\r\n                    name=\"region\"\r\n                    // Usa || '' para manejar null/undefined y que el select funcione con la opción vacía\r\n                    value={formData.region || ''} \r\n                    onChange={handleChange}\r\n                    className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                    <option value=\"\">-- Sin Región --</option>\r\n                    {regions.map(region => (\r\n                        <option key={region.id} value={region.id}>\r\n                            {region.name}\r\n                        </option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                {/* Asignar Rol */}\r\n                <div>\r\n                    <label htmlFor=\"assigned_role_id\" className=\"block text-sm font-medium text-gray-700\">Rol</label>\r\n                    <select\r\n                        id=\"assigned_role_id\"\r\n                        name=\"assigned_role_id\"\r\n                        value={formData.assigned_role_id || ''}\r\n                        onChange={handleChange}\r\n                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    >\r\n                        <option value=\"\">-- Sin Rol --</option>\r\n                        {roles.map(role => (\r\n                            <option key={role.id} value={role.id}>\r\n                                {role.name}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n\r\n                {/* Status (Select Estático) */}\r\n                <div>\r\n                    <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700\">Estado</label>\r\n                    <select\r\n                        id=\"status\"\r\n                        name=\"status\"\r\n                        value={formData.status}\r\n                        onChange={handleChange}\r\n                        className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    >\r\n                        {STATUS_CHOICES.map(choice => (\r\n                            <option key={choice} value={choice}>{choice}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n\r\n            {/* Checkboxes de Staff/Superuser (solo para Superusers logueados) */}\r\n            {loggedInUser?.is_superuser && (\r\n                <div className=\"flex space-x-6\">\r\n                    <div className=\"flex items-center space-x-2\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            name=\"is_staff\"\r\n                            id=\"is_staff\"\r\n                            checked={formData.is_staff}\r\n                            onChange={handleChange}\r\n                            className=\"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                        />\r\n                        <label htmlFor=\"is_staff\" className=\"block text-sm font-medium text-gray-700\">Es Staff</label>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            name=\"is_superuser\"\r\n                            id=\"is_superuser\"\r\n                            checked={formData.is_superuser}\r\n                            onChange={handleChange}\r\n                            className=\"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                        />\r\n                        <label htmlFor=\"is_superuser\" className=\"block text-sm font-medium text-gray-700\">Es Superuser</label>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Mensaje de Error */}\r\n            {error && (\r\n                <div className=\"p-3 bg-red-100 border border-red-400 text-red-700 rounded text-sm\">\r\n                    {error}\r\n                </div>\r\n            )}\r\n\r\n            {/* Botones de acción */}\r\n            <div className=\"flex justify-end space-x-3 pt-6 border-t border-gray-200\">\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={onClose}\r\n                    className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n                >\r\n                    Cancelar\r\n                </button>\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\r\n                >\r\n                    {loading ? 'Guardando...' : (isEditing ? 'Actualizar Usuario' : 'Crear Usuario')}\r\n                </button>\r\n            </div>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport default UserForm;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}